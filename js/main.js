var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)};define("Keyboard",["require","exports"],function(t,e){"use strict";var i;!function(t){t.keys={A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,ENTER:13,SHIFT:16,SPACE:32,ESC:27,DELETE:46,LEFT:37,UP:38,RIGHT:39,DOWN:40,"+":61,"-":173}}(i=e.Keyboard||(e.Keyboard={}))}),define("lists/MachineList",["require","exports"],function(t,e){"use strict";!function(t){t[t.FA=0]="FA",t[t.PDA=1]="PDA",t[t.LBA=2]="LBA"}(e.Machine||(e.Machine={}));e.Machine}),define("interface/Renderer",["require","exports"],function(t,e){"use strict";var i=function(){function t(){}return t.prototype.bind=function(t){this.node=t,this.onBind()},t.prototype.render=function(){this.node&&this.onRender()},t.prototype.onBind=function(){},t}();e.Renderer=i}),define("languages/Portuguese",["require","exports"],function(t,e){"use strict";var i;!function(t){t.strings={LANGUAGE_NAME:"Português",SELECT_LANGUAGE:"Idioma do Sistema",CHANGE_LANGUAGE:'Mudar o idioma para "%"?',FILE_MENUBAR:"Manipulação de Arquivos",SAVE:"Salvar",OPEN:"Abrir",PROMPT_CONFIRM:"Confirmar",PROMPT_CANCEL:"Cancelar",SELECTED_ENTITY:"Entidade selecionada",NO_SELECTED_ENTITY:"nenhuma entidade selecionada",SELECT_MACHINE:"Seleção de Máquina",CLEAR_MACHINE:"Limpar",CLEAR_CONFIRMATION:"Deseja realmente limpar o autômato?",FA:"Autômato Finito",PDA:"Autômato de Pilha",LBA:"Autômato Linearmente Limitado",RECOGNITION:"Reconhecimento",TEST_CASE:"caso de teste",FAST_RECOGNITION:"Reconhecimento rápido (R)",STEP_RECOGNITION:"Reconhecimento passo-a-passo (N)",STOP_RECOGNITION:"Parar reconhecimento passo-a-passo (S)",CHANGE_MACHINE_WARNING:"Alterar o tipo de máquina reseta o autômato. Deseja continuar?",INPUT_ACCEPTED:"aceito",INPUT_REJECTED:"rejeitado"}}(i=e.portuguese||(e.portuguese={}))}),define("languages/English",["require","exports"],function(t,e){"use strict";var i;!function(t){t.strings={LANGUAGE_NAME:"English",SELECT_LANGUAGE:"System Language",CHANGE_LANGUAGE:'Change the language to "%"?',FILE_MENUBAR:"File Manipulation",SAVE:"Save",OPEN:"Open",PROMPT_CONFIRM:"Confirm",PROMPT_CANCEL:"Cancel",SELECTED_ENTITY:"Selected entity",NO_SELECTED_ENTITY:"no selected entity",SELECT_MACHINE:"Machine Selection",CLEAR_MACHINE:"Clear",CLEAR_CONFIRMATION:"Do you really want to reset this automaton?",FA:"Finite Automaton",PDA:"Pushdown Automaton",LBA:"Linearly Bounded Automaton",RECOGNITION:"Recognition",TEST_CASE:"test case",FAST_RECOGNITION:"Fast recognition (R)",STEP_RECOGNITION:"Step-by-step recognition (N)",STOP_RECOGNITION:"Stop step-by-step recognition (S)",CHANGE_MACHINE_WARNING:"Changing the machine type resets the automaton. Do you wish to continue?",INPUT_ACCEPTED:"accepted",INPUT_REJECTED:"rejected"}}(i=e.english||(e.english={}))}),define("lists/LanguageList",["require","exports","languages/Portuguese","languages/English"],function(t,e,i,n){"use strict";function r(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}r(i),r(n)}),define("Browser",["require","exports"],function(t,e){"use strict";var i;!function(t){function e(){var t=navigator.userAgent.toLowerCase(),e=function(e){return e.test(t)},i={msie:e(/msie/)||e(/trident/),edge:e(/edge/),firefox:e(/mozilla/)&&e(/firefox/),chrome:e(/webkit/)&&e(/chrome/)&&!e(/edge/),safari:e(/safari/)&&e(/applewebkit/)&&!e(/chrome/),opera:e(/opera/)},n="",r="Unknown";for(var s in i)if(i.hasOwnProperty(s)&&i[s]){n=s;var o=new RegExp(s+"( |/)([0-9]+)"),a=t.match(o);a?r=a[2]:(a=t.match(/rv:([0-9]+)/))&&(r=a[1])}return{name:n,version:r}}var i=e();t.name=i.name,t.version=i.version}(i=e.Browser||(e.Browser={}))}),define("Utils",["require","exports","Keyboard","Settings","System"],function(t,e,i,n,r){"use strict";var s;!function(t){function e(t){return document.querySelector(t)}function s(t){return e("#"+t)}function o(t,e){var i=document.createElement(t);return e&&this.foreach(e,function(t,e){"click"==t?i.addEventListener("click",e):i[t]=e}),i}function a(t,e){for(var i in t)if(t.hasOwnProperty(i)&&e(i,t[i])===!1)break}function l(t){return"which"in t?3==t.which:"button"in t?2==t.button:(console.log("[WARNING] Right click events will not work properly in this browser."),!1)}function h(t,e,i,n){return"M"+t+" "+e+" L"+i+" "+n}function c(t,e,i,n,r){var s=t.path(this.linePath(e,i,n,r));return s.attr("stroke","black"),s}function u(t){return t*Math.PI/180}function d(t){return 180*t/Math.PI}function g(t,e,i){var n=Math.sin(i),r=Math.cos(i),s={x:t.x,y:t.y};s.x-=e.x,s.y-=e.y;var o={x:s.x*r-s.y*n,y:s.x*n+s.y*r};return{x:o.x+e.x,y:o.y+e.y}}function p(t,e){return t&&e&&t.x==e.x&&t.y==e.y}function f(t,e,i){r.System.addKeyObserver(t,e,i)}function y(t){r.System.lockShortcutGroup(t)}function S(t){r.System.unlockShortcutGroup(t)}function v(t){setTimeout(t,0)}function m(t,e,s,o){var a=this.create("div",{className:"click_blocker"}),l=this.create("div",{id:"system_prompt"});l.innerHTML=t+"<br>";for(var h=this.id(n.Settings.mainbarID),c=function(){document.body.removeChild(a),r.System.unblockEvents(),$(l).slideUp(n.Settings.promptSlideInterval,function(){h.removeChild(l)})},u=[],d=this.create("input",{type:"button",value:n.Strings.PROMPT_CONFIRM,click:function(){for(var t=[],e=0,i=u;e<i.length;e++){var n=i[e];t.push(n.value)}c(),s(t)}}),g=this.create("input",{type:"button",value:n.Strings.PROMPT_CANCEL,click:function(){c(),o&&o()}}),p=0;p<e;p++){var f=this.create("input",{type:"text"});f.addEventListener("keydown",function(t){t.keyCode==i.Keyboard.keys.ENTER?d.click():t.keyCode==i.Keyboard.keys.ESC&&g.click()}),u.push(f),l.appendChild(f)}l.appendChild(d),l.appendChild(g),document.body.insertBefore(a,document.body.children[0]),r.System.blockEvents(),$(l).toggle(),h.insertBefore(l,h.children[0]),$(l).slideDown(n.Settings.promptSlideInterval,function(){u[0].focus()})}t.select=e,t.id=s,t.create=o,t.foreach=a,t.isRightClick=l,t.linePath=h,t.line=c,t.toRadians=u,t.toDegrees=d,t.rotatePoint=g,t.samePoint=p,t.bindShortcut=f,t.lockShortcutGroup=y,t.unlockShortcutGroup=S,t.async=v,t.prompt=m}(s=e.utils||(e.utils={}))}),define("interface/State",["require","exports","Browser","Settings","Utils"],function(t,e,i,n,r){"use strict";var s=function(){function t(){this.initial=!1,this.final=!1,this.name="",this.initialMarkOffsets=[],this.defaultPalette={fillColor:n.Settings.stateFillColor,strokeColor:n.Settings.stateStrokeColor,strokeWidth:n.Settings.stateStrokeWidth,ringStrokeWidth:n.Settings.stateRingStrokeWidth},this.palette=this.defaultPalette,this.body=null,this.ring=null,this.arrowParts=[],this.textContainer=null,this.radius=n.Settings.stateRadius}return t.prototype.setPosition=function(t,e){this.x=t,this.y=e},t.prototype.getPosition=function(){return{x:this.x,y:this.y}},t.prototype.setInitial=function(t){this.initial=t},t.prototype.isInitial=function(){return this.initial},t.prototype.setFinal=function(t){this.final=t},t.prototype.isFinal=function(){return this.final},t.prototype.setName=function(t){this.name=t},t.prototype.getName=function(){return this.name},t.prototype.applyPalette=function(t){this.palette=t},t.prototype.removePalette=function(){this.palette=this.defaultPalette},t.prototype.remove=function(){this.body&&(this.body.remove(),this.body=null),this.ring&&(this.ring.remove(),this.ring=null);for(var t=0,e=this.arrowParts;t<e.length;t++){var i=e[t];i.remove()}this.arrowParts=[],this.textContainer&&(this.textContainer.remove(),this.textContainer=null)},t.prototype.render=function(t){this.renderBody(t),this.renderInitialMark(t),this.renderFinalMark(t),this.renderText(t)},t.prototype.node=function(){return this.body},t.prototype.html=function(){return this.body?this.body.node:null},t.prototype.drag=function(t,e){var n,r=this,s=function(t,e,i){var n=r.getPosition();return this.ox=n.x,this.oy=n.y,null},o=0;n="chrome"==i.Browser.name?3:4;var a=function(e,i,s,a,l){return r.setVisualPosition(this.ox+e,this.oy+i),0==o&&t.call(this,l),o=(o+1)%n,null},l=function(i){var n=r.getPosition(),s=n.x-this.ox,o=n.y-this.oy,a=s*s+o*o,l=e.call(this,a,i);return l||0==s&&0==o||r.setVisualPosition(this.ox,this.oy),t.call(this,i),null};this.body.drag(a,s,l),this.textContainer&&this.textContainer.drag(a,s,l)},t.prototype.fillColor=function(){return this.palette.fillColor},t.prototype.strokeColor=function(){return this.palette.strokeColor},t.prototype.strokeWidth=function(){return this.palette.strokeWidth},t.prototype.ringStrokeWidth=function(){return this.palette.ringStrokeWidth},t.prototype.renderBody=function(t){this.body?this.body.attr({cx:this.x,cy:this.y}):this.body=t.circle(this.x,this.y,this.radius),this.body.attr("fill",this.fillColor()),this.body.attr("stroke",this.strokeColor()),this.body.attr("stroke-width",this.strokeWidth())},t.prototype.updateInitialMarkOffsets=function(){if(this.initialMarkOffsets.length)return this.initialMarkOffsets;var t=n.Settings.stateInitialMarkLength,e=this.x-this.radius,i=this.y,s=n.Settings.stateInitialMarkHeadLength,o=n.Settings.stateInitialMarkAngle,a=1-s/t,l={x:e-t+a*t,y:i},h={x:e,y:i},c=r.utils.rotatePoint(l,h,o),u=r.utils.rotatePoint(l,h,-o);this.initialMarkOffsets=[{x:c.x-e,y:c.y-i},{x:u.x-e,y:u.y-i}]},t.prototype.renderInitialMark=function(t){if(this.initial){var e=n.Settings.stateInitialMarkLength,i=this.x-this.radius,s=this.y;if(this.arrowParts.length){var o=this.arrowParts,a=o[0],l=o[1],h=o[2];a.attr("path",r.utils.linePath(i-e,s,i,s)),this.updateInitialMarkOffsets();var c=this.initialMarkOffsets[0],u=this.initialMarkOffsets[1];l.attr("path",r.utils.linePath(c.x+i,c.y+s,i,s)),h.attr("path",r.utils.linePath(u.x+i,u.y+s,i,s))}else{var d=n.Settings.stateInitialMarkColor,g=n.Settings.stateInitialMarkThickness,a=r.utils.line(t,i-e,s,i,s);a.attr("stroke",d),a.attr("stroke-width",g),this.updateInitialMarkOffsets();var c=this.initialMarkOffsets[0],u=this.initialMarkOffsets[1],l=r.utils.line(t,c.x+i,c.y+s,i,s);l.attr("stroke",d),l.attr("stroke-width",g);var h=r.utils.line(t,u.x+i,u.y+s,i,s);h.attr("stroke",d),h.attr("stroke-width",g);var o=this.arrowParts;o.push(a),o.push(l),o.push(h)}}else for(var o=this.arrowParts;o.length;)o[o.length-1].remove(),o.pop()},t.prototype.renderFinalMark=function(t){this.final?(this.ring?this.ring.attr({cx:this.x,cy:this.y}):this.ring=t.circle(this.x,this.y,n.Settings.stateRingRadius),this.ring.attr("stroke",this.strokeColor()),this.ring.attr("stroke-width",this.ringStrokeWidth())):this.ring&&(this.ring.remove(),this.ring=null)},t.prototype.renderText=function(t){this.textContainer?(this.textContainer.attr("x",this.x),this.textContainer.attr("y",this.y),this.textContainer.attr("text",this.name)):(this.textContainer=t.text(this.x,this.y,this.name),this.textContainer.attr("font-family",n.Settings.stateLabelFontFamily),this.textContainer.attr("font-size",n.Settings.stateLabelFontSize),this.textContainer.attr("stroke",n.Settings.stateLabelFontColor),this.textContainer.attr("fill",n.Settings.stateLabelFontColor))},t.prototype.setVisualPosition=function(t,e){this.setPosition(t,e),this.body.attr({cx:t,cy:e}),this.ring&&this.ring.attr({cx:t,cy:e}),this.initial&&this.renderInitialMark(),this.renderText()},t}();e.State=s}),define("controllers/Controller",["require","exports"],function(t,e){"use strict"}),define("datastructures/Queue",["require","exports"],function(t,e){"use strict";var i=function(){function t(){this.data=[],this.pointer=0}return t.prototype.push=function(t){this.data.push(t)},t.prototype.front=function(){return this.data[this.pointer]},t.prototype.pop=function(){var t=this.front();return this.pointer++,this.pointer>=this.size()/2&&(this.data=this.data.slice(this.pointer),this.pointer=0),t},t.prototype.clear=function(){this.data=[],this.pointer=0},t.prototype.empty=function(){return 0==this.size()},t.prototype.size=function(){return this.data.length-this.pointer},t}();e.Queue=i}),define("datastructures/UnorderedSet",["require","exports"],function(t,e){"use strict";var i=function(){function t(){this.data={},this.count=0}return t.prototype.insert=function(t){this.contains(t)||this.count++,this.data[t]=!0},t.prototype.erase=function(t){this.contains(t)&&this.count--,delete this.data[t]},t.prototype.contains=function(t){return!!this.data[t]},t.prototype.clear=function(){this.data={},this.count=0},t.prototype.empty=function(){return 0==this.size()},t.prototype.size=function(){return this.count},t.prototype.forEach=function(t){for(var e in this.data)if(this.data.hasOwnProperty(e)&&t(parseFloat(e))===!1)break},t.prototype.asList=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t}();e.UnorderedSet=i}),define("machines/FA",["require","exports","datastructures/Queue","datastructures/UnorderedSet"],function(t,e,i,n){"use strict";var r=function(){function t(){this.stateList=[],this.transitions={},this.epsilonTransitions={},this.initialState=-1,this.finalStates=new n.UnorderedSet,this.currentStates=new n.UnorderedSet}return t.prototype.addState=function(t){this.stateList.push(t);var e=this.numStates()-1;return this.transitions[e]={},this.epsilonTransitions[e]=new n.UnorderedSet,this.initialState==-1&&(this.initialState=e,this.reset()),e},t.prototype.removeState=function(t){for(var e in this.transitions){var i=parseInt(e);if(this.transitions.hasOwnProperty(e)&&i!=t){var n=this.transitions[i];for(var r in n)n.hasOwnProperty(r)&&n[r].contains(t)&&this.removeTransition(i,t,r)}}this.transitions.hasOwnProperty(t+"")&&delete this.transitions[t]},t.prototype.addTransition=function(t,e,i){var r=this.transitions[t];""==i?this.epsilonTransitions[t].insert(e):(r.hasOwnProperty(i)||(r[i]=new n.UnorderedSet),r[i].insert(e))},t.prototype.removeTransition=function(t,e,i){var n=this.transitions[t];""==i?this.epsilonTransitions[t].erase(e):n.hasOwnProperty(i)&&n[i].erase(e)},t.prototype.setInitialState=function(t){t<this.numStates()&&(this.initialState=t)},t.prototype.unsetInitialState=function(){this.initialState=-1},t.prototype.getInitialState=function(){return this.initialState},t.prototype.addAcceptingState=function(t){this.finalStates.insert(t)},t.prototype.removeAcceptingState=function(t){this.finalStates.erase(t)},t.prototype.getAcceptingStates=function(){return this.finalStates.asList()},t.prototype.getStates=function(){var t=[],e=this;return this.currentStates.forEach(function(i){t.push(e.stateList[i])}),t},t.prototype.alphabet=function(){var t=[];return t},t.prototype.read=function(t){var e=new n.UnorderedSet,i=this;this.currentStates.forEach(function(n){var r=i.transition(n,t);r&&r.forEach(function(t){e.insert(t)})}),this.expandSpontaneous(e),this.currentStates=e},t.prototype.reset=function(){this.currentStates.clear(),this.currentStates.insert(this.initialState),this.expandSpontaneous(this.currentStates)},t.prototype.clear=function(){this.stateList=[],this.transitions={},this.epsilonTransitions={},this.unsetInitialState(),this.finalStates.clear(),this.currentStates.clear()},t.prototype.accepts=function(){var t=!1,e=this;return this.finalStates.forEach(function(i){if(e.currentStates.contains(i))return t=!0,!1}),t},t.prototype.error=function(){return 0==this.currentStates.size()},t.prototype.numStates=function(){return this.stateList.length},t.prototype.transition=function(t,e){return this.transitions[t][e]},t.prototype.expandSpontaneous=function(t){var e=new i.Queue;for(t.forEach(function(t){e.push(t)});!e.empty();){var n=e.pop(),r=this.epsilonTransitions[n];r.forEach(function(i){t.contains(i)||(t.insert(i),e.push(i))})}},t}();e.FA=r}),define("controllers/FAController",["require","exports","machines/FA","Utils"],function(t,e,i,n){"use strict";var r=function(){function t(){this.stateMapping={},this.stepIndex=-1,this.machine=new i.FA,window.machine=this.machine}return t.prototype.edgePrompt=function(t,e){var i=this;n.utils.prompt("Enter the edge content:",1,function(e){t(e,i.edgeDataToText(e))},e)},t.prototype.edgeDataToText=function(t){var e="ε";return t[0]||e},t.prototype.createState=function(t){var e=t.getName(),i=this.machine.addState(e);this.stateMapping[e]=i,t.isInitial()&&this.machine.setInitialState(i),t.isFinal()&&this.machine.addAcceptingState(i)},t.prototype.createEdge=function(t,e,i){var n=this.index(t),r=this.index(e),s=this.edgeDataToText(i);this.machine.addTransition(n,r,s)},t.prototype.changeInitialFlag=function(t){t.isInitial()?this.machine.setInitialState(this.index(t)):this.machine.unsetInitialState()},t.prototype.changeFinalFlag=function(t){var e=this.index(t);t.isFinal()?this.machine.addAcceptingState(e):this.machine.removeAcceptingState(e)},t.prototype.deleteState=function(t){this.machine.removeState(this.index(t))},t.prototype.deleteEdge=function(t,e,i){var n=this.index(t),r=this.index(e),s=this.edgeDataToText(i);this.machine.removeTransition(n,r,s)},t.prototype.clear=function(){this.machine.clear()},t.prototype.fastForward=function(t){this.machine.reset();for(var e=0;e<t.length;e++)this.machine.read(t[e])},t.prototype.step=function(t){if(!this.finished(t)){if(this.stepIndex==-1)this.machine.reset();else{var e=t[this.stepIndex];this.machine.read(e)}this.stepIndex++}},t.prototype.stop=function(){this.stepIndex=-1},t.prototype.finished=function(t){return this.stepIndex>=t.length},t.prototype.isStopped=function(){return this.stepIndex==-1},t.prototype.stepPosition=function(){return this.stepIndex},t.prototype.currentStates=function(){return this.machine.getStates()},t.prototype.accepts=function(){return this.machine.accepts()},t.prototype.index=function(t){return this.stateMapping[t.getName()]},t}();e.FAController=r}),define("controllers/PDAController",["require","exports","Utils"],function(t,e,i){"use strict";var n=function(){function t(){}return t.prototype.edgePrompt=function(t,e){var n=this;i.utils.prompt("Enter the edge content:",3,function(e){t(e,n.edgeDataToText(e))},e)},t.prototype.edgeDataToText=function(t){var e="ε",i=t[0]||e,n=t[1]||e,r=t[2]||e;return i+","+n+" → "+r},t.prototype.createState=function(t){},t.prototype.createEdge=function(t,e,i){},t.prototype.changeInitialFlag=function(t){},t.prototype.changeFinalFlag=function(t){},t.prototype.deleteState=function(t){},t.prototype.deleteEdge=function(t,e,i){},t.prototype.clear=function(){},t.prototype.fastForward=function(t){},t.prototype.step=function(t){},t.prototype.stop=function(){},t.prototype.finished=function(t){return!0},t.prototype.isStopped=function(){return!0},t.prototype.stepPosition=function(){return-1},t.prototype.currentStates=function(){return[]},t.prototype.accepts=function(){return!1},t}();e.PDAController=n}),define("controllers/LBAController",["require","exports"],function(t,e){"use strict";var i=function(){function t(){}return t.prototype.edgePrompt=function(t,e){console.log("[TODO] LBAController::edgePrompt()")},t.prototype.edgeDataToText=function(t){return"TODO"},t.prototype.createState=function(t){},t.prototype.createEdge=function(t,e,i){},t.prototype.changeInitialFlag=function(t){},t.prototype.changeFinalFlag=function(t){},t.prototype.deleteState=function(t){},t.prototype.deleteEdge=function(t,e,i){},t.prototype.clear=function(){},t.prototype.fastForward=function(t){},t.prototype.step=function(t){},t.prototype.stop=function(){},t.prototype.finished=function(t){return!0},t.prototype.isStopped=function(){return!0},t.prototype.stepPosition=function(){return-1},t.prototype.currentStates=function(){return[]},t.prototype.accepts=function(){return!1},t}();e.LBAController=i}),define("lists/ControllerList",["require","exports","controllers/FAController","controllers/PDAController","controllers/LBAController"],function(t,e,i,n,r){"use strict";function s(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}s(i),s(n),s(r)}),define("interface/Edge",["require","exports","Settings","Utils"],function(t,e,i,n){"use strict";var r=function(){function t(){this.origin=null,this.target=null,this.prevOriginPosition=null,this.prevTargetPosition=null,this.virtualTarget=null,this.textList=[],this.dataList=[],this.defaultColor=i.Settings.edgeStrokeColor,this.color=this.defaultColor,this.body=[],this.head=[],this.textContainer=null}return t.prototype.setOrigin=function(t){this.origin=t},t.prototype.getOrigin=function(){return this.origin},t.prototype.setTarget=function(t){this.target=t},t.prototype.getTarget=function(){return this.target},t.prototype.setVirtualTarget=function(t){this.virtualTarget=t},t.prototype.addText=function(t){this.textList.push(t)},t.prototype.getTextList=function(){return this.textList},t.prototype.addData=function(t){this.dataList.push(t)},t.prototype.getDataList=function(){return this.dataList},t.prototype.addClickHandler=function(t){for(var e=this,i=0,n=this.body;i<n.length;i++){var r=n[i];r.click(function(i){t.call(e)})}},t.prototype.remove=function(){for(var t=0,e=this.body;t<e.length;t++){var i=e[t];i.remove()}this.body=[];for(var n=0,r=this.head;n<r.length;n++){var i=r[n];i.remove()}this.head=[],this.textContainer&&(this.textContainer.remove(),this.textContainer=null)},t.prototype.setCustomColor=function(t){this.color=t},t.prototype.removeCustomColor=function(){this.color=this.defaultColor},t.prototype.render=function(t){var e=this.origin&&n.utils.samePoint(this.prevOriginPosition,this.origin.getPosition()),i=this.target&&n.utils.samePoint(this.prevTargetPosition,this.target.getPosition());e&&i||(this.renderBody(t),this.renderHead(t),this.origin&&(this.prevOriginPosition=this.origin.getPosition()),this.target&&(this.prevTargetPosition=this.target.getPosition()));for(var r=0,s=this.body;r<s.length;r++){var o=s[r];o.attr("stroke",this.strokeColor())}for(var a=0,l=this.head;a<l.length;a++){var o=l[a];o.attr("stroke",this.strokeColor())}this.target&&this.renderText(t)},t.prototype.strokeColor=function(){return this.color},t.prototype.stateCenterOffsets=function(t,e){var n=Math.atan2(e,t),r=Math.sin(n),s=Math.cos(n),o=i.Settings.stateRadius*s,a=i.Settings.stateRadius*r;return{x:o,y:a}},t.prototype.renderBody=function(t){var e,r=this.origin.getPosition();if(this.target)e=this.target.getPosition();else if(this.virtualTarget){e={x:this.virtualTarget.x,y:this.virtualTarget.y};var s=e.x-r.x,o=e.y-r.y;e.x=r.x+.98*s,e.y=r.y+.98*o}else e=r;var a=e.x-r.x,l=e.y-r.y,h=i.Settings.stateRadius,c=this.stateCenterOffsets(a,l);if(a*a+l*l>h*h&&(r.x+=c.x,r.y+=c.y),this.target&&(e.x-=c.x,e.y-=c.y),this.origin==this.target){var u=this.origin.getPosition();if(1==this.body.length&&(this.body[0].remove(),this.body=[]),this.body.length)this.body[0].attr("path",n.utils.linePath(u.x+h,u.y,u.x+2*h,u.y)),this.body[1].attr("path",n.utils.linePath(u.x+2*h,u.y,u.x+2*h,u.y-2*h)),this.body[2].attr("path",n.utils.linePath(u.x+2*h,u.y-2*h,u.x,u.y-2*h)),this.body[3].attr("path",n.utils.linePath(u.x,u.y-2*h,u.x,u.y-h));else{this.body.push(n.utils.line(t,u.x+h,u.y,u.x+2*h,u.y)),this.body.push(n.utils.line(t,u.x+2*h,u.y,u.x+2*h,u.y-2*h)),this.body.push(n.utils.line(t,u.x+2*h,u.y-2*h,u.x,u.y-2*h)),this.body.push(n.utils.line(t,u.x,u.y-2*h,u.x,u.y-h));for(var d=0,g=this.body;d<g.length;d++){var p=g[d];p.attr("stroke-width",i.Settings.edgeArrowThickness)}}}else if(this.body.length){for(;this.body.length>1;)this.body[this.body.length-1].remove(),this.body.pop();this.body[0].attr("path",n.utils.linePath(r.x,r.y,e.x,e.y))}else this.body.push(n.utils.line(t,r.x,r.y,e.x,e.y)),this.body[0].attr("stroke-width",i.Settings.edgeArrowThickness)},t.prototype.renderHead=function(t){if(this.target){var e,r,s,o;if(this.origin==this.target){var a=this.origin.getPosition(),l=i.Settings.stateRadius;e={x:a.x,y:a.y-2*l},r={x:a.x,y:a.y-l},s=0,o=l}else{e=this.origin.getPosition(),r=this.target.getPosition(),s=r.x-e.x,o=r.y-e.y;var h=this.stateCenterOffsets(s,o);r.x-=h.x,r.y-=h.y,s-=h.x,o-=h.y}var c=i.Settings.edgeArrowLength,u=i.Settings.edgeArrowAngle,d=Math.sqrt(s*s+o*o),g=1-c/d,p={x:e.x+g*s,y:e.y+g*o},f=n.utils.rotatePoint(p,r,u),y=n.utils.rotatePoint(p,r,-u);if(this.head.length)this.head[0].attr("path",n.utils.linePath(f.x,f.y,r.x,r.y)),this.head[1].attr("path",n.utils.linePath(y.x,y.y,r.x,r.y));else{this.head.push(n.utils.line(t,f.x,f.y,r.x,r.y)),this.head.push(n.utils.line(t,y.x,y.y,r.x,r.y));for(var S=0,v=this.head;S<v.length;S++){var m=v[S];m.attr("stroke-width",i.Settings.edgeArrowThickness)}}}},t.prototype.preparedText=function(){return this.textList.join("\n")},t.prototype.renderText=function(t){var e,r,s=this.origin.getPosition(),o=this.target.getPosition();if(this.origin==this.target){var a=i.Settings.stateRadius;e=s.x+a,r=s.y-2*a}else e=(s.x+o.x)/2,r=(s.y+o.y)/2;this.textContainer?(this.textContainer.attr("x",e),this.textContainer.attr("y",r),this.textContainer.attr("text",this.preparedText()),this.textContainer.transform("")):(this.textContainer=t.text(e,r,this.preparedText()),this.textContainer.attr("font-family",i.Settings.edgeTextFontFamily),this.textContainer.attr("font-size",i.Settings.edgeTextFontSize),this.textContainer.attr("stroke",i.Settings.edgeTextFontColor),this.textContainer.attr("fill",i.Settings.edgeTextFontColor));var l=Math.atan2(o.y-s.y,o.x-s.x),h=n.utils.toDegrees(l);(h<-90||h>90)&&(h=(h+180)%360),this.textContainer.rotate(h),r-=.6*i.Settings.edgeTextFontSize,r-=i.Settings.edgeTextFontSize*(this.textList.length-1)*.7,this.textContainer.attr("y",r)},t}();e.Edge=r}),define("interface/Table",["require","exports","interface/Renderer","Utils"],function(t,e,i,n){"use strict";var r=function(t){function e(e,i){t.call(this),this.customColspans={},this.numRows=e,this.numColumns=i,this.children=[]}return __extends(e,t),e.prototype.add=function(t,e){e&&(this.customColspans[this.children.length]=e),this.children.push(t)},e.prototype.html=function(){for(var t=n.utils.create("table"),e=0,i=0;i<this.numRows;i++){for(var r=n.utils.create("tr"),s=0;s<this.numColumns;s++){var o=n.utils.create("td");if(e<this.children.length){if(this.customColspans.hasOwnProperty(e+"")){var a=this.customColspans[e];o.colSpan=a,s+=a-1}o.appendChild(this.children[e])}r.appendChild(o),e++}t.appendChild(r)}return t},e.prototype.onRender=function(){this.node.appendChild(this.html())},e}(i.Renderer);e.Table=r}),define("interface/AutomatonRenderer",["require","exports","interface/Edge","Settings","interface/State","Utils","interface/Table"],function(t,e,i,n,r,s,o){"use strict";var a=function(){function t(t,e){this.canvas=null,this.node=null,this.stateList=[],this.edgeList=[],this.highlightedState=null,this.highlightedEdge=null,this.initialState=null,this.edgeMode=!1,this.currentEdge=null,this.locked=!1,this.canvas=t,this.node=e}return t.prototype.render=function(){var t=this.newState("q0");t.setPosition(100,200);var e=this.newState("q1");e.setPosition(250,350);var n=this.newState("q2");n.setPosition(450,350);var r=this.newState("q3");r.setPosition(650,350);var s=new i.Edge;s.setOrigin(t),s.setTarget(t),this.addEdgeData(s,["0"]),this.addEdgeData(s,["1"]),this.edgeList.push(s);var o=new i.Edge;o.setOrigin(t),o.setTarget(e),this.addEdgeData(o,["1"]),this.edgeList.push(o);var a=new i.Edge;a.setOrigin(e),a.setTarget(n),this.addEdgeData(a,["0"]),this.addEdgeData(a,["1"]),this.edgeList.push(a);var l=new i.Edge;l.setOrigin(n),l.setTarget(r),this.addEdgeData(l,["0"]),this.addEdgeData(l,["1"]),this.edgeList.push(l),this.updateEdges(),this.setInitialState(t),this.changeFinalFlag(r,!0),this.bindEvents(),this.bindShortcuts()},t.prototype.clear=function(){for(var t=0,e=this.stateList;t<e.length;t++){var i=e[t];i.remove()}this.stateList=[];for(var r=0,s=this.edgeList;r<s.length;r++){var o=s[r];o.remove()}this.edgeList=[],this.initialState=null,this.clearSelection(),n.Settings.controller().clear()},t.prototype.empty=function(){return 0==this.stateList.length},t.prototype.save=function(){for(var t=[n.Settings.Machine[n.Settings.currentMachine],[],[],-1],e=0,i=0,r=this.stateList;i<r.length;i++){var s=r[i],o=s.getPosition();t[1].push([s.getName(),s.isFinal()?1:0,o.x,o.y]),s==this.initialState&&(t[3]=e),e++}for(var a=0,l=this.edgeList;a<l.length;a++){var h=l[a];t[2].push([h.getOrigin().getName(),h.getTarget().getName(),h.getDataList()])}return JSON.stringify(t)},t.prototype.load=function(t){var e=this,s=function(){e.clear(),alert("Invalid file")},o=[];try{o=JSON.parse(t)}catch(t){return void s()}var a=n.Settings.Machine[n.Settings.currentMachine],l=o[0]==a&&o[1]instanceof Array&&o[2]instanceof Array&&"number"==typeof o[3]&&4==o.length;if(!l)return void s();for(var h={},c=n.Settings.controller(),u=0,d=0,g=o[1];d<g.length;d++){var p=g[d],f=o[3]==u,y=new r.State;y.setName(p[0]),y.setInitial(f),y.setFinal(!!p[1]),y.setPosition(p[2],p[3]),f&&(this.initialState=y),h[p[0]]=u,this.stateList.push(y),c.createState(y),u++}for(var S=this.stateList,v=0,m=o[2];v<m.length;v++){var E=m[v];if(3!=E.length)return void s();var x=new i.Edge,b=S[h[E[0]]],C=S[h[E[1]]];x.setOrigin(b),x.setTarget(C);for(var T=0,L=E[2];T<L.length;T++){var p=L[T];this.addEdgeData(x,p)}this.edgeList.push(x)}for(var k=0,M=this.stateList;k<M.length;k++){var y=M[k];y.render(this.canvas),this.bindStateEvents(y)}for(var P=0,I=this.edgeList;P<I.length;P++){var x=I[P];x.render(this.canvas)}},t.prototype.recognitionHighlight=function(t){for(var e={},i=0,r=this.stateList;i<r.length;i++){var s=r[i];e[s.getName()]=s,s.removePalette()}for(var o=0,a=t;o<a.length;o++){var l=a[o];e[l].applyPalette(n.Settings.stateRecognitionPalette)}for(var h=0,c=this.stateList;h<c.length;h++){var s=c[h];s.render(this.canvas)}},t.prototype.recognitionDim=function(){for(var t=0,e=this.stateList;t<e.length;t++){var i=e[t];i.removePalette(),i.render(this.canvas)}this.highlightedState=null},t.prototype.lock=function(){s.utils.lockShortcutGroup(n.Settings.canvasShortcutID),this.locked=!0},t.prototype.unlock=function(){s.utils.unlockShortcutGroup(n.Settings.canvasShortcutID),this.locked=!1},t.prototype.selectState=function(t){this.locked||(this.dimEdge(),this.highlightedState&&(this.highlightedState.removePalette(),this.highlightedState.render(this.canvas)),t.applyPalette(n.Settings.stateHighlightPalette),this.highlightedState=t,t.render(this.canvas),this.updateEditableState(t))},t.prototype.dimState=function(){!this.locked&&this.highlightedState&&(this.highlightedState.removePalette(),this.highlightedState.render(this.canvas),this.highlightedState=null,n.Settings.sidebar.unsetSelectedEntityContent())},t.prototype.selectEdge=function(t){this.locked||(this.dimState(),this.highlightedEdge&&(this.highlightedEdge.removeCustomColor(),this.highlightedEdge.render(this.canvas)),t.setCustomColor("red"),this.highlightedEdge=t,t.render(this.canvas),this.updateEditableEdge(t))},t.prototype.dimEdge=function(){!this.locked&&this.highlightedEdge&&(this.highlightedEdge.removeCustomColor(),this.highlightedEdge.render(this.canvas),this.highlightedEdge=null,n.Settings.sidebar.unsetSelectedEntityContent())},t.prototype.updateEditableState=function(t){n.Settings.sidebar.unsetSelectedEntityContent(),n.Settings.sidebar.setSelectedEntityContent(this.showEditableState(t))},t.prototype.updateEditableEdge=function(t){n.Settings.sidebar.unsetSelectedEntityContent(),n.Settings.sidebar.setSelectedEntityContent(this.showEditableEdge(t))},t.prototype.showEditableState=function(t){var e=s.utils.create("div"),i=new o.Table(4,3),r=this.canvas,a=this,l=s.utils.create("input",{type:"button",value:"rename",click:function(){var e=prompt("gimme new name pl0x");t.setName(e),t.render(r),$("#entity_name").html(e)}}),h=s.utils.create("input",{type:"button",value:"toggle",click:function(){a.setInitialState(t),t.render(r),$("#entity_initial").html(t.isInitial()?"yes":"no")}}),c=s.utils.create("input",{type:"button",value:"toggle",click:function(){a.changeFinalFlag(t,!t.isFinal()),t.render(r),$("#entity_initial").html(t.isFinal()?"yes":"no")}}),u=s.utils.create("input",{type:"button",value:"Delete state",click:function(){a.deleteState(t),a.clearSelection(),n.Settings.sidebar.unsetSelectedEntityContent()}});return i.add(s.utils.create("span",{innerHTML:"Name:"})),i.add(s.utils.create("span",{innerHTML:t.getName(),
className:"property_value",id:"entity_name"})),i.add(l),i.add(s.utils.create("span",{innerHTML:"Is initial:"})),i.add(s.utils.create("span",{innerHTML:t.isInitial()?"yes":"no",className:"property_value",id:"entity_initial"})),i.add(h),i.add(s.utils.create("span",{innerHTML:"Is final:"})),i.add(s.utils.create("span",{innerHTML:t.isFinal()?"yes":"no",className:"property_value",id:"entity_final"})),i.add(c),i.add(u,3),e.appendChild(i.html()),e},t.prototype.showEditableEdge=function(t){var e=s.utils.create("div"),i=new o.Table(5,3),r=this.canvas,a=this,l=s.utils.create("input",{type:"button",value:"change",click:function(){for(var e=prompt("gimme new origin pl0x"),i=0,n=a.stateList;i<n.length;i++){var s=n[i];s.getName()==e&&t.setOrigin(s)}t.render(r),$("#entity_origin").html(e)}}),h=s.utils.create("input",{type:"button",value:"change",click:function(){for(var e=prompt("gimme new target pl0x"),i=0,n=a.stateList;i<n.length;i++){var s=n[i];s.getName()==e&&t.setTarget(s)}t.render(r),$("#entity_origin").html(e)}}),c=s.utils.create("input",{type:"button",value:"change",click:function(){var e=$("#entity_transition_list").get(0),i=e.selectedIndex,r=(e[i].innerHTML,n.Settings.controller());r.edgePrompt(function(e,n){var s=t.getOrigin(),o=t.getTarget(),l=t.getDataList();r.deleteEdge(s,o,l[i]),t.getDataList()[i]=e,t.getTextList()[i]=n,t.render(a.canvas),r.createEdge(s,o,e),a.updateEditableEdge(t)})}}),u=s.utils.create("input",{type:"button",value:"Delete selected transition",click:function(){var t=$("#entity_transition_list").get(0);console.log(t.selectedIndex),console.log(t.children[t.selectedIndex].innerHTML)}}),d=s.utils.create("input",{type:"button",value:"Delete all transitions",click:function(){n.Settings.sidebar.unsetSelectedEntityContent()}});i.add(s.utils.create("span",{innerHTML:"Origin:"})),i.add(s.utils.create("span",{innerHTML:t.getOrigin().getName(),className:"property_value",id:"entity_origin"})),i.add(l),i.add(s.utils.create("span",{innerHTML:"Target:"})),i.add(s.utils.create("span",{innerHTML:t.getTarget().getName(),className:"property_value",id:"entity_target"})),i.add(h);for(var g=s.utils.create("select",{id:"entity_transition_list"}),p=t.getTextList(),f=0,y=0,S=p;y<S.length;y++){var v=S[y],m=s.utils.create("option",{value:f,innerHTML:v});g.appendChild(m),f++}return i.add(s.utils.create("span",{innerHTML:"Transitions:"})),i.add(g),i.add(c),i.add(u,3),i.add(d,3),e.appendChild(i.html()),e},t.prototype.bindEvents=function(){for(var t=0,e=this.stateList;t<e.length;t++){var i=e[t];i.render(this.canvas),this.bindStateEvents(i)}for(var o=0,a=this.edgeList;o<a.length;o++){var l=a[o];this.bindEdgeEvents(l)}var h=this;$(this.node).dblclick(function(t){if(!h.locked){var e=new r.State;e.setPosition(t.pageX-this.offsetLeft,t.pageY-this.offsetTop),h.selectState(e),h.bindStateEvents(e);var i=function(){s.utils.prompt("Enter the state name:",1,function(t){for(var r=t[0],s=0,o=h.stateList;s<o.length;s++){var a=o[s];if(a.getName()==r)return alert("State name already in use"),i()}h.stateList.push(e),e.setName(r),e.render(h.canvas),n.Settings.controller().createState(e)},function(){h.highlightedState=null,e.remove()})};i()}}),$(this.node).contextmenu(function(t){return t.preventDefault(),!1}),$(this.node).mousemove(function(t){h.edgeMode&&h.adjustEdge(this,t)})},t.prototype.bindEdgeEvents=function(t){var e=this;t.addClickHandler(function(){e.selectEdge(this)})},t.prototype.bindStateEvents=function(t){var e=(this.canvas,this);t.drag(function(){e.updateEdges()},function(i,r){return!(!e.locked&&i<=n.Settings.stateDragTolerance)||(e.edgeMode?e.finishEdge(t):s.utils.isRightClick(r)?e.beginEdge(t):t==e.highlightedState?e.dimState():e.selectState(t),!1)})},t.prototype.beginEdge=function(t){this.edgeMode=!0,this.currentEdge=new i.Edge,this.currentEdge.setOrigin(t)},t.prototype.finishEdge=function(t){this.edgeMode=!1;for(var e=this.currentEdge.getOrigin(),i=function(i,r){var s=n.Settings.controller();s.edgePrompt(function(n,r){s.createEdge(e,t,n),i(n,r)},r)},r=this,s=function(){r.currentEdge.remove(),r.currentEdge=null},o=function(n){if(n.getOrigin()==e&&n.getTarget()==t)return i(function(t,e){n.addText(e),n.addData(t),n.render(r.canvas),s()},s),{value:void 0}},a=0,l=this.edgeList;a<l.length;a++){var h=l[a],c=o(h);if("object"==typeof c)return c.value}this.currentEdge.setTarget(t),this.currentEdge.render(this.canvas),i(function(t,e){r.currentEdge.addText(e),r.currentEdge.addData(t),r.bindEdgeEvents(r.currentEdge),r.currentEdge.render(r.canvas),r.edgeList.push(r.currentEdge),r.currentEdge=null},s)},t.prototype.adjustEdge=function(t,e){var i={x:e.pageX-t.offsetLeft,y:e.pageY-t.offsetTop};this.currentEdge.setVirtualTarget(i),this.currentEdge.render(this.canvas)},t.prototype.updateEdges=function(){for(var t=0,e=this.edgeList;t<e.length;t++){var i=e[t];i.render(this.canvas)}},t.prototype.clearSelection=function(){this.highlightedState=null,this.highlightedEdge=null,n.Settings.sidebar.unsetSelectedEntityContent(),this.edgeMode&&(this.edgeMode=!1,this.currentEdge.remove(),this.currentEdge=null)},t.prototype.newState=function(t){var e=new r.State;return e.setName(t),this.stateList.push(e),n.Settings.controller().createState(e),e},t.prototype.setInitialState=function(t){var e=n.Settings.controller();t==this.initialState?(t.setInitial(!1),e.changeInitialFlag(t),this.initialState=null):(this.initialState&&(this.initialState.setInitial(!1),e.changeInitialFlag(this.initialState),this.initialState.render(this.canvas)),t.setInitial(!0),e.changeInitialFlag(t),this.initialState=t)},t.prototype.changeFinalFlag=function(t,e){t.setFinal(e),n.Settings.controller().changeFinalFlag(t)},t.prototype.addEdgeData=function(t,e){var i=n.Settings.controller();t.addText(i.edgeDataToText(e)),t.addData(e),i.createEdge(t.getOrigin(),t.getTarget(),e)},t.prototype.deleteState=function(t){for(var e=0;e<this.edgeList.length;e++){var i=this.edgeList[e],r=i.getOrigin(),s=i.getTarget();r!=t&&s!=t||(i.remove(),this.edgeList.splice(e,1),e--)}t.remove();for(var o=this.stateList,e=0;e<o.length;e++)if(o[e]==t){o.splice(e,1);break}n.Settings.controller().deleteState(t)},t.prototype.toggleInitial=function(){var t=this.highlightedState;t&&(this.setInitialState(t),t.render(this.canvas))},t.prototype.toggleFinal=function(){var t=this.highlightedState;t&&(this.changeFinalFlag(t,!t.isFinal()),t.render(this.canvas))},t.prototype.bindShortcuts=function(){var t=this,e=n.Settings.canvasShortcutID;s.utils.bindShortcut(n.Settings.shortcuts.toggleInitial,function(){t.toggleInitial()},e),s.utils.bindShortcut(n.Settings.shortcuts.toggleFinal,function(){t.toggleFinal()},e),s.utils.bindShortcut(n.Settings.shortcuts.dimSelection,function(){t.dimState(),t.dimEdge()},e),s.utils.bindShortcut(n.Settings.shortcuts.deleteState,function(){var e=t.highlightedState;e&&(t.deleteState(e),t.clearSelection())},e),s.utils.bindShortcut(n.Settings.shortcuts.clearMachine,function(){var e=confirm(n.Strings.CLEAR_CONFIRMATION);e&&t.clear()},e),s.utils.bindShortcut(n.Settings.shortcuts.left,function(){t.moveStateSelection(function(t,e){return t.getPosition().x<e.getPosition().x},function(e,i,n){if(!i)return!0;var r=n.getPosition(),s=e.getPosition(),o=Math.abs(s.y-r.y),a=i.getPosition(),l=Math.abs(a.y-r.y),h=t.selectionThreshold();return o<h?l>=h||s.x>a.x:o<l})},e),s.utils.bindShortcut(n.Settings.shortcuts.right,function(){t.moveStateSelection(function(t,e){return t.getPosition().x>e.getPosition().x},function(e,i,n){if(!i)return!0;var r=n.getPosition(),s=e.getPosition(),o=Math.abs(s.y-r.y),a=i.getPosition(),l=Math.abs(a.y-r.y),h=t.selectionThreshold();return o<h?l>=h||s.x<a.x:o<l})},e),s.utils.bindShortcut(n.Settings.shortcuts.up,function(){t.moveStateSelection(function(t,e){return t.getPosition().y<e.getPosition().y},function(e,i,n){if(!i)return!0;var r=n.getPosition(),s=e.getPosition(),o=Math.abs(s.x-r.x),a=i.getPosition(),l=Math.abs(a.x-r.x),h=t.selectionThreshold();return o<h?l>=h||s.y>a.y:o<l})},e),s.utils.bindShortcut(n.Settings.shortcuts.down,function(){t.moveStateSelection(function(t,e){return t.getPosition().y>e.getPosition().y},function(e,i,n){if(!i)return!0;var r=n.getPosition(),s=e.getPosition(),o=Math.abs(s.x-r.x),a=i.getPosition(),l=Math.abs(a.x-r.x),h=t.selectionThreshold();return o<t.selectionThreshold()?l>=h||s.y<a.y:o<l})},e),s.utils.bindShortcut(n.Settings.shortcuts.undo,function(){alert("TODO: undo")},e)},t.prototype.selectionThreshold=function(){return 2*n.Settings.stateRadius},t.prototype.moveStateSelection=function(t,e){var i=this.highlightedState;if(i){for(var n=null,r=0,s=this.stateList;r<s.length;r++){var o=s[r];t(o,i)&&e(o,n,i)&&(n=o)}n&&this.selectState(n)}},t}();e.AutomatonRenderer=a}),define("initializers/initFA",["require","exports","Keyboard","interface/Menu","Settings","Utils"],function(t,e,i,n,r,s){"use strict";var o;!function(t){function e(){var t=[],e=new n.Menu(r.Strings.RECOGNITION),i=[];a(i),h(i),c(i),d(),g();for(var o=0,l=i;o<l.length;o++){for(var u=l[o],p=s.utils.create("div",{className:"row"}),f=0,y=u;f<y.length;f++){var S=y[f];p.appendChild(S)}e.add(p)}t.push(e),r.Settings.machines[r.Settings.Machine.FA].sidebar=t}function o(){return f.value}function a(t){var e=s.utils.create("input",{type:"text",placeholder:r.Strings.TEST_CASE});t.push([e]),f=e}function l(){var t=r.Settings.controller().currentStates();r.Settings.automatonRenderer.recognitionHighlight(t)}function h(t){var e=r.Settings.disabledButtonClass;y=s.utils.create("img",{className:"image_button",src:"images/fastforward.svg",title:r.Strings.FAST_RECOGNITION}),v=s.utils.create("img",{className:"image_button "+e,src:"images/stop.svg",title:r.Strings.STOP_RECOGNITION}),S=s.utils.create("img",{className:"image_button",src:"images/play.svg",title:r.Strings.STEP_RECOGNITION}),t.push([y,S,v])}function c(t){m=s.utils.create("div",{id:"recognition_progress"}),m.style.display="none",t.push([m])}function u(){r.Settings.controller().accepts()?(m.style.color=r.Settings.acceptedTestCaseColor,m.innerHTML=r.Strings.INPUT_ACCEPTED):(m.style.color=r.Settings.rejectedTestCaseColor,m.innerHTML=r.Strings.INPUT_REJECTED)}function d(){var t=r.Settings.disabledButtonClass,e=!0,i=!0,n=!1,a=function(i){e=i,y.classList[i?"remove":"add"](t)},h=function(e){i=e,S.classList[e?"remove":"add"](t)},c=function(e){n=e,v.classList[e?"remove":"add"](t)};y.addEventListener("click",function(){if(e){r.Settings.automatonRenderer.lock();var t=o(),i=r.Settings.controller();i.fastForward(t),l(),m.style.display="",u(),a(!1),h(!1),c(!0),f.disabled=!0}}),v.addEventListener("click",function(){n&&(r.Settings.controller().stop(),r.Settings.automatonRenderer.recognitionDim(),r.Settings.automatonRenderer.unlock(),m.style.color="black",m.style.display="none",a(!0),h(!0),c(!1),f.disabled=!1)}),S.addEventListener("click",function(){if(i){a(!1),c(!0),f.disabled=!0;var t=o(),e=r.Settings.controller();if(e.isStopped()){r.Settings.automatonRenderer.lock(),m.style.display="";var n=s.utils.id(r.Settings.sidebarID),d=n.offsetWidth;d-=10,d-=1,m.style.width=d+"px"}var g=e.finished(t);g||(e.step(t),l(),g=e.finished(t));var p=e.stepPosition(),y=t.substr(p);""==y?u():m.innerHTML=y,g&&h(!1)}})}function g(){p||(s.utils.bindShortcut(r.Settings.shortcuts.focusTestCase,function(){f.focus()}),f.addEventListener("keydown",function(t){t.keyCode==i.Keyboard.keys[r.Settings.shortcuts.dimTestCase[0]]&&f==document.activeElement&&f.blur()}),s.utils.bindShortcut(r.Settings.shortcuts.fastForward,function(){y.click()}),s.utils.bindShortcut(r.Settings.shortcuts.step,function(){S.click()}),s.utils.bindShortcut(r.Settings.shortcuts.stop,function(){v.click()}),p=!0)}t.init=e;var p=!1,f=null,y=null,S=null,v=null,m=null}(o=e.initFA||(e.initFA={}))}),define("initializers/initPDA",["require","exports"],function(t,e){"use strict";var i;!function(t){function e(){console.log("[INIT] PDA")}t.init=e}(i=e.initPDA||(e.initPDA={}))}),define("initializers/initLBA",["require","exports"],function(t,e){"use strict";var i;!function(t){function e(){console.log("[INIT] LBA")}t.init=e}(i=e.initLBA||(e.initLBA={}))}),define("lists/InitializerList",["require","exports","initializers/initFA","initializers/initPDA","initializers/initLBA"],function(t,e,i,n,r){"use strict";function s(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}s(i),s(n),s(r)}),define("Initializer",["require","exports","lists/InitializerList","Utils"],function(t,e,i,n){"use strict";var r=function(){function t(){}return t.exec=function(){this.initSidebars()},t.initSidebars=function(){n.utils.foreach(i,function(t,e){e.init()})},t}();e.Initializer=r}),define("Settings",["require","exports","lists/LanguageList","lists/MachineList","lists/ControllerList","Initializer","Utils"],function(t,e,i,n,r,s,o){"use strict";var a;!function(t){function a(){return this.machines[this.currentMachine].controller}function l(){if(c)for(var e in t.Machine)t.Machine.hasOwnProperty(e)&&!isNaN(parseInt(e))&&(t.controllerMap[e]=new r[t.Machine[e]+"Controller"]);var i={};for(var e in t.Machine)t.Machine.hasOwnProperty(e)&&!isNaN(parseInt(e))&&(i[e]={name:t.language.strings[t.Machine[e]],sidebar:[],controller:t.controllerMap[e]});o.utils.foreach(i,function(e,i){t.machines[e]=i}),c=!1,s.Initializer.exec()}function h(i){t.language=i,e.Strings=t.language.strings,l()}t.sidebarID="sidebar",t.mainbarID="mainbar",t.disabledButtonClass="disabled",t.canvasShortcutID="canvas",t.menuSlideInterval=300,t.promptSlideInterval=200,t.machineSelRows=3,t.machineSelColumns=1,t.stateRadius=32,t.stateRingRadius=27,t.stateDragTolerance=50,t.stateFillColor="white",t.stateStrokeColor="black",t.stateStrokeWidth=1,t.stateRingStrokeWidth=1,t.stateLabelFontFamily="arial",t.stateLabelFontSize=20,t.stateLabelFontColor="black",t.stateInitialMarkLength=40,t.stateInitialMarkHeadLength=15,t.stateInitialMarkAngle=o.utils.toRadians(20),t.stateInitialMarkColor="blue",t.stateInitialMarkThickness=2,t.stateHighlightPalette={fillColor:"#FFD574",strokeColor:"red",strokeWidth:3,ringStrokeWidth:2},t.stateRecognitionPalette={fillColor:"#CCC",strokeColor:"black",strokeWidth:3,ringStrokeWidth:2},t.edgeStrokeColor="black",t.edgeArrowThickness=2,t.edgeArrowLength=30,t.edgeArrowAngle=o.utils.toRadians(30),t.edgeTextFontFamily="arial",t.edgeTextFontSize=20,t.edgeTextFontColor="black",t.acceptedTestCaseColor="green",t.rejectedTestCaseColor="red",t.shortcuts={save:["ctrl","S"],open:["ctrl","O"],toggleInitial:["I"],toggleFinal:["F"],dimSelection:["ESC"],deleteState:["DELETE"],clearMachine:["C"],left:["LEFT"],right:["RIGHT"],up:["UP"],down:["DOWN"],undo:["ctrl","Z"],focusTestCase:["ctrl","I"],dimTestCase:["ENTER"],fastForward:["R"],step:["N"],stop:["S"]},t.languages=i,t.Machine=n.Machine,t.language=i.english,t.currentMachine=0,t.machines={},t.controllerMap={},t.sidebar=null,t.automatonRenderer=null,t.controller=a;var c=!0;t.update=l,t.changeLanguage=h}(a=e.Settings||(e.Settings={})),e.Strings=a.language.strings}),define("interface/Menu",["require","exports","interface/Renderer","Settings","Utils"],function(t,e,i,n,r){"use strict";var s=function(t){function e(e){t.call(this),this.body=null,this.toggled=!1,this.title=e,this.children=[]}return __extends(e,t),e.prototype.add=function(t){this.children.push(t)},e.prototype.clear=function(){this.children=[]},e.prototype.onRender=function(){var t=this.node,e=r.utils.create("div");e.classList.add("menu");var i=r.utils.create("div");i.classList.add("menu_arrow");var s=r.utils.create("div");s.classList.add("title"),s.appendChild(i),s.innerHTML+=this.title,e.appendChild(s);var o=r.utils.create("div");o.classList.add("content");for(var a=0,l=this.children;a<l.length;a++){var h=l[a];o.appendChild(h)}e.appendChild(o),t.appendChild(e);var c=this;s.addEventListener("click",function(){$(o).is(":animated")||$(o).slideToggle(n.Settings.menuSlideInterval,function(){c.updateArrow()})}),this.body=e,this.toggled&&this.internalToggle(),this.updateArrow()},e.prototype.toggle=function(){this.toggled=!this.toggled,this.body&&this.internalToggle()},e.prototype.html=function(){return this.body},e.prototype.content=function(){return this.body.querySelector(".content")},e.prototype.updateArrow=function(){var t=this.body.querySelector(".menu_arrow");"none"==$(this.content()).css("display")?t.innerHTML="&#x25BA;":t.innerHTML="&#x25BC;"},e.prototype.internalToggle=function(){$(this.content()).toggle()},e}(i.Renderer);e.Menu=s}),define("interface/Sidebar",["require","exports","interface/Menu","interface/Renderer","Settings","Settings","System","interface/Table","Utils"],function(t,e,i,n,r,s,o,a,l){"use strict";var h=function(t){function e(){t.call(this),this.build()}return __extends(e,t),e.prototype.build=function(){this.languageSelection=new i.Menu(s.Strings.SELECT_LANGUAGE),this.fileManipulation=new i.Menu(s.Strings.FILE_MENUBAR),this.selectedEntity=new i.Menu(s.Strings.SELECTED_ENTITY),this.machineSelection=new i.Menu(s.Strings.SELECT_MACHINE),this.otherMenus=[],this.buildLanguageSelection(),this.buildFileManipulation(),this.buildSelectedEntityArea(),this.buildMachineSelection(),this.node&&this.onBind()},e.prototype.setSelectedEntityContent=function(t){var e=this.selectedEntity.content();$(e.querySelector(".none")).hide(),e.appendChild(t)},e.prototype.unsetSelectedEntityContent=function(){for(var t=this.selectedEntity.content();t.children.length>1;)t.removeChild(t.children[t.children.length-1]);$(t.querySelector(".none")).show()},e.prototype.onBind=function(){this.languageSelection.bind(this.node),this.fileManipulation.bind(this.node),this.selectedEntity.bind(this.node),this.machineSelection.bind(this.node);for(var t=0,e=this.otherMenus;t<e.length;t++){var i=e[t];i.bind(this.node)}r.Settings.sidebar=this},e.prototype.onRender=function(){this.languageSelection.render(),this.fileManipulation.render(),this.selectedEntity.render(),this.machineSelection.render(),this.renderDynamicMenus()},e.prototype.renderDynamicMenus=function(){for(var t=0,e=this.otherMenus;t<e.length;t++){var i=e[t];i.render()}},e.prototype.loadMachine=function(t){for(var e=0,i=this.otherMenus;e<i.length;e++){var n=i[e];$(n.html()).remove()}this.otherMenus=r.Settings.machines[t].sidebar;for(var s=0,o=this.otherMenus;s<o.length;s++){var n=o[s];n.bind(this.node)}},e.prototype.buildLanguageSelection=function(){var t=l.utils.create("select"),e=r.Settings.languages,i={},n=0;l.utils.foreach(e,function(e,s){var o=l.utils.create("option");o.value=n.toString(),o.innerHTML=s.strings.LANGUAGE_NAME,t.appendChild(o),i[n]=e,s==r.Settings.language&&(t.selectedIndex=n),n++}),this.languageSelection.clear(),this.languageSelection.add(t),this.languageSelection.toggle(),t.addEventListener("change",function(t){var n=this,r=n.options[n.selectedIndex],a=r.value,l=r.innerHTML,h=confirm(s.Strings.CHANGE_LANGUAGE.replace("%",l));h&&o.System.changeLanguage(e[i[a]])})},e.prototype.buildFileManipulation=function(){this.fileManipulation.clear();var t=l.utils.create("input",{className:"file_manip_btn",type:"button",value:s.Strings.SAVE,click:function(){var t=r.Settings.automatonRenderer.save(),e=new Blob([t],{type:"text/plain; charset=utf-8"});saveAs(e,"file.txt")}});l.utils.bindShortcut(r.Settings.shortcuts.save,function(){t.click()}),this.fileManipulation.add(t);var e=l.utils.create("input",{id:"file_selector",type:"file"});e.addEventListener("change",function(t){var e=t.target.files[0];if(this.value="",e){var i=new FileReader;i.onload=function(t){r.Settings.automatonRenderer.load(t.target.result)},i.readAsText(e)}});var i=l.utils.create("input",{className:"file_manip_btn",type:"button",value:s.Strings.OPEN,click:function(){e.click(),this.blur()}});l.utils.bindShortcut(r.Settings.shortcuts.open,function(){i.click()}),this.fileManipulation.add(i)},e.prototype.buildSelectedEntityArea=function(){var t=l.utils.create("span",{className:"none",innerHTML:s.Strings.NO_SELECTED_ENTITY});this.selectedEntity.add(t)},e.prototype.buildMachineSelection=function(){var t=new a.Table(r.Settings.machineSelRows,r.Settings.machineSelColumns),e={},i=this;l.utils.foreach(r.Settings.machines,function(n,o){var a=l.utils.create("input");a.classList.add("machine_selection_btn"),a.type="button",a.value=o.name,a.disabled=n==r.Settings.currentMachine,a.addEventListener("click",function(){(r.Settings.automatonRenderer.empty()||confirm(s.Strings.CHANGE_MACHINE_WARNING))&&(r.Settings.automatonRenderer.clear(),e[r.Settings.currentMachine].disabled=!1,e[n].disabled=!0,e[n].blur(),r.Settings.currentMachine=n,i.loadMachine(n),i.renderDynamicMenus())}),t.add(a),e[n]=a}),l.utils.bindShortcut(["M"],function(){for(var t=document.querySelectorAll(".machine_selection_btn"),e=0;e<t.length;e++){var i=t[e];if(!i.disabled){i.focus();break}}}),this.machineSelection.clear(),this.machineSelection.add(t.html()),this.loadMachine(r.Settings.currentMachine)},e}(n.Renderer);e.Sidebar=h}),define("System",["require","exports","Keyboard","Settings","Utils"],function(t,e,i,n,r){"use strict";var s=function(){function t(){}return t.changeLanguage=function(t){n.Settings.changeLanguage(t),this.reload()},t.reload=function(){r.utils.id(n.Settings.sidebarID).innerHTML="",this.sidebar.build(),this.sidebar.render()},t.bindSidebar=function(t){this.sidebar=t},t.keyEvent=function(t){for(var e=!1,i=0,n=this.keyboardObservers;i<n.length;i++){var r=n[i],s=r.keys;!this.locked(r)&&this.shortcutMatches(t,s)&&(r.callback(),e=!0)}return!e||(t.preventDefault(),!1)},t.addKeyObserver=function(t,e,i){this.keyboardObservers.push({keys:t,callback:e,group:i})},t.lockShortcutGroup=function(t){this.lockedGroups[t]=!0},t.unlockShortcutGroup=function(t){delete this.lockedGroups[t]},t.blockEvents=function(){this.eventBlock=!0},t.unblockEvents=function(){this.eventBlock=!1},t.shortcutMatches=function(t,e){function n(t){return t+"Key"}if(this.eventBlock)return!1;for(var r=["alt","ctrl","shift"],s=[],o=0,a=e;o<a.length;o++){var l=a[o];if(r.indexOf(l)>=0){if(s.push(l),!t[n(l)])return!1}else if(t.keyCode!=i.Keyboard.keys[l])return!1}for(var h=0,c=r;h<c.length;h++){var u=c[h];if(s.indexOf(u)==-1&&t[n(u)])return!1}return!0},t.locked=function(t){return this.lockedGroups.hasOwnProperty(t.group)},t.keyboardObservers=[],t.eventBlock=!1,t.lockedGroups={},t}();e.System=s}),define("interface/Mainbar",["require","exports","interface/AutomatonRenderer","interface/Renderer","Settings"],function(t,e,i,n,r){"use strict";var s=function(t){function e(){t.call(this),this.canvas=null,this.automatonRenderer=null;var e=this;$(window).resize(function(){e.resizeCanvas()})}return __extends(e,t),e.prototype.resizeCanvas=function(){var t=this.canvas;if(t){var e=$(this.node);t.setSize(50,50);var i=e.width(),n=e.height()-10;t.setSize(i,n)}},e.prototype.onBind=function(){this.canvas=Raphael(this.node,0,0),this.resizeCanvas(),this.automatonRenderer=new i.AutomatonRenderer(this.canvas,this.node),r.Settings.automatonRenderer=this.automatonRenderer},e.prototype.onRender=function(){this.automatonRenderer.render()},e}(n.Renderer);e.Mainbar=s}),define("interface/UI",["require","exports","interface/Mainbar","Settings","interface/Sidebar","System","Utils"],function(t,e,i,n,r,s,o){"use strict";var a=function(){function t(){var t=new r.Sidebar,e=new i.Mainbar;this.bindSidebar(t),this.bindMain(e),s.System.bindSidebar(t)}return t.prototype.render=function(){this.sidebarRenderer.render(),this.mainRenderer.render(),console.log("Interface ready.")},t.prototype.bindSidebar=function(t){t.bind(o.utils.id(n.Settings.sidebarID)),this.sidebarRenderer=t},t.prototype.bindMain=function(t){t.bind(o.utils.id(n.Settings.mainbarID)),this.mainRenderer=t},t}();e.UI=a}),define("main",["require","exports","Settings","System","interface/UI"],function(t,e,i,n,r){"use strict";i.Settings.update(),$(document).ready(function(){var t=new r.UI;t.render(),document.body.addEventListener("keydown",function(t){if("input"!=document.activeElement.tagName.toLowerCase())return n.System.keyEvent(t)})})});
